<div class="form-group">
                <div class="question-text">
                    <div class="question-left">
                        <span class="question-number">1</span>
                        <div class="question-left-text">疲れが残っている</div>
                    </div>
                    <div class="question-right">← 疲れが取れている →</div>
                </div>
                <div class="radio-group">
                    <div class="radio-option">
                        <input type="radio" id="q1_1" name="q1" value="1">
                        <label for="q1_1">非常に</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="q1_2" name="q1" value="2">
                        <label for="q1_2">やや</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="q1_3" name="q1" value="3">
                        <label for="q1_3">やや</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="q1_4" name="q1" value="4">
                        <label for="q1_4">非常に</label>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <div class="question-text">
                    <div class="question-left">
                        <span class="question-number">2</span>
                        <div class="question-left-text">集中力がある</div>
                    </div>
                    <div class="question-right">← 集中力がない →</div>
                </div>
                <div class="radio-group">
                    <div class="radio-option">
                        <input type="radio" id="q2_1" name="q2" value="1">
                        <label for="q2_1">非常に</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="q2_2" name="q2" value="2">
                        <label for="q2_2">やや</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="q2_3" name="q2" value="3">
                        <label for="q2_3">やや</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="q2_4" name="q2" value="4">
                        <label for="q2_4">非常に</label>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <div class="question-text">
                    <div class="question-left">
                        <span class="question-number">3</span>
                        <div class="question-left-text">ぐっすり眠れた</div>
                    </div>
                    <div class="question-right">← ぐっすり眠れなかった →</div>
                </div>
                <div class="radio-group">
                    <div class="radio-option">
                        <input type="radio" id="q3_1" name="q3" value="1">
                        <label for="q3_1">非常に</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="q3_2" name="q3" value="2">
                        <label for="q3_2">やや</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="q3_3" name="q3" value="3">
                        <label for="q3_3">やや</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="q3_4" name="q3" value="4">
                        <label for="q3_4">非常に</label>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <div class="question-text">
                    <div class="question-left">
                        <span class="question-number">4</span>
                        <div class="question-left-text">解放感がある</div>
                    </div>
                    <div class="question-right">← ストレスを感じる →</div>
                </div>
                <div class="radio-group">
                    <div class="radio-option">
                        <input type="radio" id="q4_1" name="q4" value="1">
                        <label for="q4_1">非常に</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="q4_2" name="q4" value="2">
                        <label for="q4_2">やや</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="q4_3" name="q4" value="3">
                        <label for="q4_3">やや</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="q4_4" name="q4" value="4">
                        <label for="q4_4">非常に</label>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <div class="question-text">
                    <div class="question-left">
                        <span class="question-number">5</span>
                        <div class="question-left-text">身体がだるい</div>
                    </div>
                    <div class="question-right">← 身体がシャキッとしている →</div>
                </div>
                <div class="radio-group">
                    <div class="radio-option">
                        <input type="radio" id="q5_1" name="q5" value="1">
                        <label for="q5_1">非常に</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="q5_2" name="q5" value="2">
                        <label for="q5_2">やや</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="q5_3" name="q5" value="3">
                        <label for="q5_3">やや</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="q5_4" name="q5" value="4">
                        <label for="q5_4">非常に</label>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <div class="question-text">
                    <div class="question-left">
                        <span class="question-number">6</span>
                        <div class="question-left-text">食欲がある</div>
                    </div>
                    <div class="question-right">← 食欲がない →</div>
                </div>
                <div class="radio-group">
                    <div class="radio-option">
                        <input type="radio" id="q6_1" name="q6" value="1">
                        <label for="q6_1">非常に</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="q6_2" name="q6" value="2">
                        <label for="q6_2">やや</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="q6_3" name="q6" value="3">
                        <label for="q6_3">やや</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="q6_4" name="q6" value="4">
                        <label for="q6_4">非常に</label>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <div class="question-text">
                    <div class="question-left">
                        <span class="question-number">7</span>
                        <div class="question-left-text">寝つくまでにウトウトしていた状態が多かった</div>
                    </div>
                    <div class="question-right">← 寝つくまでにウトウトしていた状態が少なかった →</div>
                </div>
                <div class="radio-group">
                    <div class="radio-option">
                        <input type="radio" id="q7_1" name="q7" value="1">
                        <label for="q7_1">非常に</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="q7_2" name="q7" value="2">
                        <label for="q7_2">やや</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="q7_3" name="q7" value="3">
                        <label for="q7_3">やや</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="q7_4" name="q7" value="4">
                        <label for="q7_4">非常に</label>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <div class="question-text">
                    <div class="question-left">
                        <span class="question-number">8</span>
                        <div class="question-left-text">頭がはっきりしている</div>
                    </div>
                    <div class="question-right">← 頭がボーとしている →</div>
                </div>
                <div class="radio-group">
                    <div class="radio-option">
                        <input type="radio" id="q8_1" name="q8" value="1">
                        <label for="q8_1">非常に</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="q8_2" name="q8" value="2">
                        <label for="q8_2">やや</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="q8_3" name="q8" value="3">
                        <label for="q8_3">やや</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="q8_4" name="q8" value="4">
                        <label for="q8_4">非常に</label>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <div class="question-text">
                    <div class="question-left">
                        <span class="question-number">9</span>
                        <div class="question-left-text">悪夢が多かった</div>
                    </div>
                    <div class="question-right">← 悪夢は見なかった →</div>
                </div>
                <div class="radio-group">
                    <div class="radio-option">
                        <input type="radio" id="q9_1" name="q9" value="1">
                        <label for="q9_1">非常に</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="q9_2" name="q9" value="2">
                        <label for="q9_2">やや</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="q9_3" name="q9" value="3">
                        <label for="q9_3">やや</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="q9_4" name="q9" value="4">
                        <label for="q9_4">非常に</label>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <div class="question-text">
                    <div class="question-left">
                        <span class="question-number">10</span>
                        <div class="question-left-text">寝付きがよかった</div>
                    </div>
                    <div class="question-right">← 寝付きが悪かった →</div>
                </div>
                <div class="radio-group">
                    <div class="radio-option">
                        <input type="radio" id="q10_1" name="q10" value="1">
                        <label for="q10_1">非常に</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="q10_2" name="q10" value="2">
                        <label for="q10_2">やや</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="q10_3" name="q10" value="3">
                        <label for="q10_3">やや</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="q10_4" name="q10" value="4">
                        <label for="q10_4">非常に</label>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <div class="question-text">
                    <div class="question-left">
                        <span class="question-number">11</span>
                        <div class="question-left-text">不快な気分である</div>
                    </div>
                    <div class="question-right">← さわやかな気分である →</div>
                </div>
                <div class="radio-group">
                    <div class="radio-option">
                        <input type="radio" id="q11_1" name="q11" value="1">
                        <label for="q11_1">非常に</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="q11_2" name="q11" value="2">
                        <label for="q11_2">やや</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="q11_3" name="q11" value="3">
                        <label for="q11_3">やや</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="q11_4" name="q11" value="4">
                        <label for="q11_4">非常に</label>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <div class="question-text">
                    <div class="question-left">
                        <span class="question-number">12</span>
                        <div class="question-left-text">しょっちゅう夢を見た</div>
                    </div>
                    <div class="question-right">← 夢をみなかった →</div>
                </div>
                <div class="radio-group">
                    <div class="radio-option">
                        <input type="radio" id="q12_1" name="q12" value="1">
                        <label for="q12_1">非常に</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="q12_2" name="q12" value="2">
                        <label for="q12_2">やや</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="q12_3" name="q12" value="3">
                        <label for="q12_3">やや</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="q12_4" name="q12" value="4">
                        <label for="q12_4">非常に</label>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <div class="question-text">
                    <div class="question-left">
                        <span class="question-number">13</span>
                        <div class="question-left-text">睡眠中にしょっちゅう目が覚めた</div>
                    </div>
                    <div class="question-right">← 睡眠中に目が覚めなかった →</div>
                </div>
                <div class="radio-group">
                    <div class="radio-option">
                        <input type="radio" id="q13_1" name="q13" value="1">
                        <label for="q13_1">非常に</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="q13_2" name="q13" value="2">
                        <label for="q13_2">やや</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="q13_3" name="q13" value="3">
                        <label for="q13_3">やや</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="q13_4" name="q13" value="4">
                        <label for="q13_4">非常に</label>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <div class="question-text">
                    <div class="question-left">
                        <span class="question-number">14</span>
                        <div class="question-left-text">いますぐ、調査にテキパキと答えられる</div>
                    </div>
                    <div class="question-right">← 答えるのは面倒である →</div>
                </div>
                <div class="radio-group">
                    <div class="radio-option">
                        <input type="radio" id="q14_1" name="q14" value="1">
                        <label for="q14_1">非常に</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="q14_2" name="q14" value="2">
                        <label for="q14_2">やや</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="q14_3" name="q14" value="3">
                        <label for="q14_3">やや</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="q14_4" name="q14" value="4">
                        <label for="q14_4">非常に</label>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <div class="question-text">
                    <div class="question-left">
                        <span class="question-number">15</span>
                        <div class="question-left-text">睡眠時間が長かった</div>
                    </div>
                    <div class="question-right">← 睡眠時間が短かった →</div>
                </div>
                <div class="radio-group">
                    <div class="radio-option">
                        <input type="radio" id="q15_1" name="q15" value="1">
                        <label for="q15_1">非常に</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="q15_2" name="q15" value="2">
                        <label for="q15_2">やや</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="q15_3" name="q15" value="3">
                        <label for="q15_3">やや</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="q15_4" name="q15" value="4">
                        <label for="q15_4">非常に</label>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <div class="question-text">
                    <div class="question-left">
                        <span class="question-number">16</span>
                        <div class="question-left-text">眠りが浅かった</div>
                    </div>
                    <div class="question-right">← 眠りが深かった →</div>
                </div>
                <div class="radio-group">
                    <div class="radio-option">
                        <input type="radio" id="q16_1" name="q16" value="1">
                        <label for="q16_1">非常に</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="q16_2" name="q16" value="2">
                        <label for="q16_2">やや</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="q16_3" name="q16" value="3">
                        <label for="q16_3">やや</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="q16_4" name="q16" value="4">
                        <label for="q16_4">非常に</label>
                    </div>
                </div>
            </div><!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OSA-MA睡眠調査票 集計フォーム</title>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <style>
        body {
            font-family: 'Noto Sans JP', 'Hiragino Sans', 'Yu Gothic', sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
            line-height: 1.6;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 30px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            margin: 0;
            font-size: 24px;
            font-weight: 300;
        }
        
        .header p {
            margin: 10px 0 0 0;
            opacity: 0.9;
            font-size: 14px;
        }
        
        .form-container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .participant-info {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .form-group {
            margin-bottom: 25px;
            padding: 20px;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            background: #fdfdfd;
        }
        
        .form-group:nth-child(even) {
            background: #f8f9fa;
        }
        
        .question-number {
            display: inline-block;
            background: #667eea;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            text-align: center;
            line-height: 30px;
            font-weight: bold;
            margin-right: 15px;
            font-size: 14px;
        }
        
        .question-text {
            font-size: 16px;
            font-weight: 500;
            margin-bottom: 15px;
            color: #2c3e50;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .question-left {
            display: flex;
            align-items: center;
        }
        
        .question-right {
            font-size: 14px;
            color: #6c757d;
            font-style: italic;
        }
        
        .radio-group {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-top: 15px;
        }
        
        .radio-option {
            display: flex;
            align-items: center;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
        }
        
        .radio-option:hover {
            border-color: #667eea;
            background: #f8f9ff;
        }
        
        .radio-option input[type="radio"] {
            margin-right: 8px;
            transform: scale(1.2);
        }
        
        .radio-option input[type="radio"]:checked + label {
            color: #667eea;
            font-weight: bold;
        }
        
        .radio-option:has(input:checked) {
            border-color: #667eea;
            background: #f0f4ff;
        }
        
        .radio-option label {
            cursor: pointer;
            font-size: 13px;
            line-height: 1.3;
        }
        
        .input-field {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }
        
        .input-field:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 40px;
            justify-content: center;
        }
        
        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s ease;
            min-width: 120px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }
        
        .results {
            margin-top: 30px;
            padding: 25px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }
        
        .results h3 {
            color: #2c3e50;
            margin-bottom: 15px;
        }
        
        .factor-score {
            display: grid;
            grid-template-columns: 1fr auto;
            padding: 10px 15px;
            margin: 8px 0;
            background: white;
            border-radius: 6px;
            border: 1px solid #dee2e6;
        }
        
        .factor-name {
            font-weight: 500;
            color: #2c3e50;
        }
        
        .factor-value {
            font-weight: bold;
            color: #667eea;
            font-size: 18px;
        }
        
        .liff-status {
            background: #00C300;
            color: white;
            padding: 10px;
            border-radius: 6px;
            margin-bottom: 20px;
            text-align: center;
            font-size: 14px;
        }
        
        .liff-error {
            background: #ff4757;
            color: white;
            padding: 10px;
            border-radius: 6px;
            margin-bottom: 20px;
            text-align: center;
            font-size: 14px;
        }
        
        .user-info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid #dee2e6;
        }
        
        .user-info h4 {
            margin: 0 0 10px 0;
            color: #2c3e50;
            font-size: 16px;
        }
        
        .user-info p {
            margin: 5px 0;
            font-size: 14px;
            color: #6c757d;
        }
        
        .btn-line {
            background: #00C300;
            color: white;
        }
        
        .btn-line:hover {
            background: #00B900;
            transform: translateY(-2px);
        }
        
        @media (max-width: 768px) {
            .participant-info {
                grid-template-columns: 1fr;
            }
            
            .radio-group {
                grid-template-columns: 1fr 1fr;
                gap: 8px;
            }
            
            .radio-option {
                padding: 10px 8px;
            }
            
            .radio-option label {
                font-size: 12px;
            }
            
            .question-text {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }
            
            .question-right {
                font-size: 13px;
                margin-left: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>OSA-MA睡眠調査票</h1>
        <p>看護研究用データ収集フォーム</p>
    </div>

    <div class="form-container">
        <div id="liffStatus" class="liff-status" style="display: none;">
            LIFFアプリとして起動中...
        </div>
        
        <div id="liffError" class="liff-error" style="display: none;">
            LIFF初期化エラー
        </div>
        
        <div id="userInfo" class="user-info" style="display: none;">
            <h4>ユーザー情報</h4>
            <p id="userName">名前: 取得中...</p>
            <p id="userId">ユーザーID: 取得中...</p>
        </div>

        <form id="osaForm">
            <div class="participant-info">
                <div>
                    <label for="surveyDate">調査日:</label>
                    <input type="date" id="surveyDate" name="surveyDate" class="input-field">
                </div>
            </div>

            <div class="form-group">
                <div class="question-text">
                    <div class="question-left">
                        <span class="question-number">1</span>疲れが残っている
                    </div>
                    <div class="question-right">疲れが取れている</div>
                </div>
                <div class="radio-group">
                    <div class="radio-option">
                        <input type="radio" id="q1_1" name="q1" value="1">
                        <label for="q1_1">非常に</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="q1_2" name="q1" value="2">
                        <label for="q1_2">やや</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="q1_3" name="q1" value="3">
                        <label for="q1_3">やや</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="q1_4" name="q1" value="4">
                        <label for="q1_4">非常に</label>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <div class="question-text">
                    <div class="question-left">
                        <span class="question-number">2</span>集中力がある
                    </div>
                    <div class="question-right">集中力がない</div>
                </div>
                <div class="radio-group">
                    <div class="radio-option">
                        <input type="radio" id="q2_1" name="q2" value="1">
                        <label for="q2_1">非常に</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="q2_2" name="q2" value="2">
                        <label for="q2_2">やや</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="q2_3" name="q2" value="3">
                        <label for="q2_3">やや</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="q2_4" name="q2" value="4">
                        <label for="q2_4">非常に</label>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <div class="question-text">
                    <div class="question-left">
                        <span class="question-number">3</span>ぐっすり眠れた
                    </div>
                    <div class="question-right">ぐっすり眠れなかった</div>
                </div>
                <div class="radio-group">
                    <div class="radio-option">
                        <input type="radio" id="q3_1" name="q3" value="1">
                        <label for="q3_1">非常に</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="q3_2" name="q3" value="2">
                        <label for="q3_2">やや</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="q3_3" name="q3" value="3">
                        <label for="q3_3">やや</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="q3_4" name="q3" value="4">
                        <label for="q3_4">非常に</label>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <div class="question-text">
                    <div class="question-left">
                        <span class="question-number">4</span>解放感がある
                    </div>
                    <div class="question-right">ストレスを感じる</div>
                </div>
                <div class="radio-group">
                    <div class="radio-option">
                        <input type="radio" id="q4_1" name="q4" value="1">
                        <label for="q4_1">非常に</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="q4_2" name="q4" value="2">
                        <label for="q4_2">やや</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="q4_3" name="q4" value="3">
                        <label for="q4_3">やや</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="q4_4" name="q4" value="4">
                        <label for="q4_4">非常に</label>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <div class="question-text">
                    <div class="question-left">
                        <span class="question-number">5</span>身体がだるい
                    </div>
                    <div class="question-right">身体がシャキッとしている</div>
                </div>
                <div class="radio-group">
                    <div class="radio-option">
                        <input type="radio" id="q5_1" name="q5" value="1">
                        <label for="q5_1">非常に</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="q5_2" name="q5" value="2">
                        <label for="q5_2">やや</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="q5_3" name="q5" value="3">
                        <label for="q5_3">やや</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="q5_4" name="q5" value="4">
                        <label for="q5_4">非常に</label>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <div class="question-text">
                    <div class="question-left">
                        <span class="question-number">6</span>食欲がある
                    </div>
                    <div class="question-right">食欲がない</div>
                </div>
                <div class="radio-group">
                    <div class="radio-option">
                        <input type="radio" id="q6_1" name="q6" value="1">
                        <label for="q6_1">非常に</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="q6_2" name="q6" value="2">
                        <label for="q6_2">やや</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="q6_3" name="q6" value="3">
                        <label for="q6_3">やや</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="q6_4" name="q6" value="4">
                        <label for="q6_4">非常に</label>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <div class="question-text">
                    <div class="question-left">
                        <span class="question-number">7</span>寝つくまでにウトウトしていた状態が多かった
                    </div>
                    <div class="question-right">寝つくまでにウトウトしていた状態が少なかった</div>
                </div>
                <div class="radio-group">
                    <div class="radio-option">
                        <input type="radio" id="q7_1" name="q7" value="1">
                        <label for="q7_1">非常に</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="q7_2" name="q7" value="2">
                        <label for="q7_2">やや</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="q7_3" name="q7" value="3">
                        <label for="q7_3">やや</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="q7_4" name="q7" value="4">
                        <label for="q7_4">非常に</label>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <div class="question-text">
                    <div class="question-left">
                        <span class="question-number">8</span>頭がはっきりしている
                    </div>
                    <div class="question-right">頭がボーとしている</div>
                </div>
                <div class="radio-group">
                    <div class="radio-option">
                        <input type="radio" id="q8_1" name="q8" value="1">
                        <label for="q8_1">非常に</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="q8_2" name="q8" value="2">
                        <label for="q8_2">やや</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="q8_3" name="q8" value="3">
                        <label for="q8_3">やや</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="q8_4" name="q8" value="4">
                        <label for="q8_4">非常に</label>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <div class="question-text">
                    <div class="question-left">
                        <span class="question-number">9</span>悪夢が多かった
                    </div>
                    <div class="question-right">悪夢は見なかった</div>
                </div>
                <div class="radio-group">
                    <div class="radio-option">
                        <input type="radio" id="q9_1" name="q9" value="1">
                        <label for="q9_1">非常に</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="q9_2" name="q9" value="2">
                        <label for="q9_2">やや</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="q9_3" name="q9" value="3">
                        <label for="q9_3">やや</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="q9_4" name="q9" value="4">
                        <label for="q9_4">非常に</label>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <div class="question-text">
                    <div class="question-left">
                        <span class="question-number">10</span>寝付きがよかった
                    </div>
                    <div class="question-right">寝付きが悪かった</div>
                </div>
                <div class="radio-group">
                    <div class="radio-option">
                        <input type="radio" id="q10_1" name="q10" value="1">
                        <label for="q10_1">非常に</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="q10_2" name="q10" value="2">
                        <label for="q10_2">やや</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="q10_3" name="q10" value="3">
                        <label for="q10_3">やや</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="q10_4" name="q10" value="4">
                        <label for="q10_4">非常に</label>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <div class="question-text">
                    <div class="question-left">
                        <span class="question-number">11</span>不快な気分である
                    </div>
                    <div class="question-right">さわやかな気分である</div>
                </div>
                <div class="radio-group">
                    <div class="radio-option">
                        <input type="radio" id="q11_1" name="q11" value="1">
                        <label for="q11_1">非常に</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="q11_2" name="q11" value="2">
                        <label for="q11_2">やや</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="q11_3" name="q11" value="3">
                        <label for="q11_3">やや</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="q11_4" name="q11" value="4">
                        <label for="q11_4">非常に</label>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <div class="question-text">
                    <div class="question-left">
                        <span class="question-number">12</span>しょっちゅう夢を見た
                    </div>
                    <div class="question-right">夢をみなかった</div>
                </div>
                <div class="radio-group">
                    <div class="radio-option">
                        <input type="radio" id="q12_1" name="q12" value="1">
                        <label for="q12_1">非常に</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="q12_2" name="q12" value="2">
                        <label for="q12_2">やや</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="q12_3" name="q12" value="3">
                        <label for="q12_3">やや</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="q12_4" name="q12" value="4">
                        <label for="q12_4">非常に</label>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <div class="question-text">
                    <div class="question-left">
                        <span class="question-number">13</span>睡眠中にしょっちゅう目が覚めた
                    </div>
                    <div class="question-right">睡眠中に目が覚めなかった</div>
                </div>
                <div class="radio-group">
                    <div class="radio-option">
                        <input type="radio" id="q13_1" name="q13" value="1">
                        <label for="q13_1">非常に</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="q13_2" name="q13" value="2">
                        <label for="q13_2">やや</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="q13_3" name="q13" value="3">
                        <label for="q13_3">やや</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="q13_4" name="q13" value="4">
                        <label for="q13_4">非常に</label>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <div class="question-text">
                    <div class="question-left">
                        <span class="question-number">14</span>いますぐ、調査にテキパキと答えられる
                    </div>
                    <div class="question-right">答えるのは面倒である</div>
                </div>
                <div class="radio-group">
                    <div class="radio-option">
                        <input type="radio" id="q14_1" name="q14" value="1">
                        <label for="q14_1">非常に</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="q14_2" name="q14" value="2">
                        <label for="q14_2">やや</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="q14_3" name="q14" value="3">
                        <label for="q14_3">やや</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="q14_4" name="q14" value="4">
                        <label for="q14_4">非常に</label>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <div class="question-text">
                    <div class="question-left">
                        <span class="question-number">15</span>睡眠時間が長かった
                    </div>
                    <div class="question-right">睡眠時間が短かった</div>
                </div>
                <div class="radio-group">
                    <div class="radio-option">
                        <input type="radio" id="q15_1" name="q15" value="1">
                        <label for="q15_1">非常に</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="q15_2" name="q15" value="2">
                        <label for="q15_2">やや</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="q15_3" name="q15" value="3">
                        <label for="q15_3">やや</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="q15_4" name="q15" value="4">
                        <label for="q15_4">非常に</label>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <div class="question-text">
                    <div class="question-left">
                        <span class="question-number">16</span>眠りが浅かった
                    </div>
                    <div class="question-right">眠りが深かった</div>
                </div>
                <div class="radio-group">
                    <div class="radio-option">
                        <input type="radio" id="q16_1" name="q16" value="1">
                        <label for="q16_1">非常に</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="q16_2" name="q16" value="2">
                        <label for="q16_2">やや</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="q16_3" name="q16" value="3">
                        <label for="q16_3">やや</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="q16_4" name="q16" value="4">
                        <label for="q16_4">非常に</label>
                    </div>
                </div>
            </div>

            <div class="button-group">
                <button type="button" class="btn btn-primary" onclick="showResults()">回答確認</button>
                <button type="button" class="btn btn-secondary" onclick="resetForm()">リセット</button>
                <button type="button" class="btn btn-secondary" onclick="exportData()">データ出力</button>
                <button type="button" class="btn btn-line" onclick="sendToLine()" id="sendLineBtn" style="display: none;">LINEに送信</button>
                <button type="button" class="btn btn-line" onclick="shareToLine()" id="shareLineBtn">LINE共有</button>
            </div>
        </form>

        <div id="results" class="results" style="display: none;">
            <h3>回答確認</h3>
            <div id="responsesList"></div>
            <div id="exportData" class="export-data" style="display: none;"></div>
        </div>
    </div>

    <!-- 共有モーダル -->
    <div id="shareModal" class="share-modal">
        <div class="share-content">
            <h3>📊 睡眠調査結果を共有</h3>
            <div id="sharePreview" class="share-preview"></div>
            <div class="share-buttons">
                <button class="btn btn-line" onclick="executeLineShare()">LINE で共有</button>
                <button class="btn btn-secondary" onclick="copyShareText()">テキストをコピー</button>
                <button class="btn btn-secondary" onclick="closeShareModal()">キャンセル</button>
            </div>
        </div>
    </div>

    <script>
        // LIFF関連の変数
        let liffInitialized = false;
        let userProfile = null;
        
        // LIFF初期化
        async function initializeLiff() {
            try {
                document.getElementById('liffStatus').style.display = 'block';
                document.getElementById('liffStatus').textContent = 'LIFF初期化中...';
                
                // LIFF IDは実際の環境では適切なIDに置き換えてください
                await liff.init({ liffId: '2007512404-yJ8kmAW9' });
                
                if (liff.isLoggedIn()) {
                    // ユーザープロフィール取得
                    userProfile = await liff.getProfile();
                    document.getElementById('userInfo').style.display = 'block';
                    document.getElementById('userName').textContent = `名前: ${userProfile.displayName}`;
                    document.getElementById('userId').textContent = `ユーザーID: ${userProfile.userId}`;
                    document.getElementById('sendLineBtn').style.display = 'inline-block';
                    
                    document.getElementById('liffStatus').textContent = 'LINE連携完了';
                    setTimeout(() => {
                        document.getElementById('liffStatus').style.display = 'none';
                    }, 2000);
                } else {
                    liff.login();
                }
                
                liffInitialized = true;
            } catch (error) {
                console.error('LIFF初期化エラー:', error);
                document.getElementById('liffStatus').style.display = 'none';
                document.getElementById('liffError').style.display = 'block';
                document.getElementById('liffError').textContent = 'LIFF初期化に失敗しました。ブラウザでも利用可能です。';
            }
        }
        
        // LINE共有機能（LIFFアプリ外でも使用可能）
        function shareToLine() {
            const form = document.getElementById('osaForm');
            const formData = new FormData(form);
            
            // 全項目の回答チェック
            let allAnswered = true;
            const responses = {};
            
            for (let i = 1; i <= 16; i++) {
                const value = formData.get(`q${i}`);
                if (!value) {
                    allAnswered = false;
                    break;
                }
                responses[i] = parseInt(value);
            }
            
            if (!allAnswered) {
                alert('すべての項目に回答してから共有してください。');
                return;
            }
            
            // 共有テキストを生成
            const shareText = generateShareText(responses, formData.get('surveyDate'));
            document.getElementById('sharePreview').textContent = shareText;
            document.getElementById('shareModal').style.display = 'flex';
        }
        
        function generateShareText(responses, surveyDate) {
            let shareText = `🌙 OSA-MA睡眠調査結果\n📅 ${surveyDate}\n\n`;
            
            // 1～16項目の回答数字のみ
            for (let i = 1; i <= 16; i++) {
                shareText += `Q${i}: ${responses[i]}\n`;
            }
            
            shareText += `\n💤 OSA-MA睡眠調査票による評価結果`;
            shareText += `\n\n#睡眠調査 #OSA_MA #睡眠の質`;
            
            return shareText;
        }
        
        function executeLineShare() {
            const shareText = document.getElementById('sharePreview').textContent;
            const encodedText = encodeURIComponent(shareText);
            
            // LINE共有URL（LINE公式の共有機能）
            const lineShareUrl = `https://social-plugins.line.me/lineit/share?url=${encodeURIComponent(window.location.href)}&text=${encodedText}`;
            
            // モバイルかデスクトップかで処理を分ける
            if (navigator.userAgent.match(/iPhone|iPad|iPod|Android/i)) {
                // モバイルの場合、LINEアプリで開く
                window.open(lineShareUrl, '_blank');
            } else {
                // デスクトップの場合、QRコード表示またはコピー
                copyShareText();
                alert('テキストをクリップボードにコピーしました。\nLINEで貼り付けて共有してください。');
            }
            
            closeShareModal();
        }
        
        function copyShareText() {
            const shareText = document.getElementById('sharePreview').textContent;
            navigator.clipboard.writeText(shareText).then(() => {
                alert('共有テキストをクリップボードにコピーしました！');
            }).catch(() => {
                // フォールバック（古いブラウザ対応）
                const textArea = document.createElement('textarea');
                textArea.value = shareText;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                alert('共有テキストをコピーしました！');
            });
            closeShareModal();
        }
        
        function closeShareModal() {
            document.getElementById('shareModal').style.display = 'none';
        }
        
        // モーダル外クリックで閉じる
        document.addEventListener('click', function(e) {
            const modal = document.getElementById('shareModal');
            if (e.target === modal) {
                closeShareModal();
            }
        });

        // LINEに結果を送信（LIFF内での使用）
        async function sendToLine() {
            if (!liffInitialized || !liff.isLoggedIn()) {
                alert('LINE連携が必要です。');
                return;
            }
            
            const form = document.getElementById('osaForm');
            const formData = new FormData(form);
            
            // 全項目の回答チェック
            let allAnswered = true;
            const responses = {};
            
            for (let i = 1; i <= 16; i++) {
                const value = formData.get(`q${i}`);
                if (!value) {
                    allAnswered = false;
                    break;
                }
                responses[i] = parseInt(value);
            }
            
            if (!allAnswered) {
                alert('すべての項目に回答してから送信してください。');
                return;
            }
            
            // 調査日
            const surveyDate = formData.get('surveyDate') || '';
            
            // LINEメッセージ作成（LIFF用に簡潔化）
            const shareText = generateShareText(responses, surveyDate);
            
            try {
                await liff.sendMessages([{
                    type: 'text',
                    text: shareText
                }]);
                
                alert('結果をLINEに送信しました！');
            } catch (error) {
                console.error('LINE送信エラー:', error);
                alert('LINE送信に失敗しました。');
            }
        }

        function showResults() {
            const form = document.getElementById('osaForm');
            const formData = new FormData(form);
            
            // 全項目の回答チェック
            let allAnswered = true;
            const responses = {};
            
            for (let i = 1; i <= 16; i++) {
                const value = formData.get(`q${i}`);
                if (!value) {
                    allAnswered = false;
                    break;
                }
                responses[i] = parseInt(value);
            }
            
            if (!allAnswered) {
                alert('すべての項目に回答してください。');
                return;
            }
            
            // 結果表示
            displayResponses(responses);
        }

        function displayResponses(responses) {
            const resultsDiv = document.getElementById('results');
            const responsesListDiv = document.getElementById('responsesList');
            
            const questionTexts = [
                "疲れが残っている",
                "集中力がある", 
                "ぐっすり眠れた",
                "解放感がある",
                "身体がだるい",
                "食欲がある",
                "寝つくまでにウトウトしていた状態が多かった",
                "頭がはっきりしている",
                "悪夢が多かった",
                "寝付きがよかった",
                "不快な気分である",
                "しょっちゅう夢を見た",
                "睡眠中にしょっちゅう目が覚めた",
                "いますぐ、調査にテキパキと答えられる",
                "睡眠時間が長かった",
                "眠りが浅かった"
            ];

            const questionTextsRight = [
                "疲れが取れている",
                "集中力がない",
                "ぐっすり眠れなかった", 
                "ストレスを感じる",
                "身体がシャキッとしている",
                "食欲がない",
                "寝つくまでにウトウトしていた状態が少なかった",
                "頭がボーとしている",
                "悪夢は見なかった",
                "寝付きが悪かった",
                "さわやかな気分である",
                "夢をみなかった",
                "睡眠中に目が覚めなかった",
                "答えるのは面倒である",
                "睡眠時間が短かった",
                "眠りが深かった"
            ];
            
            const scoreLabels = ["非常に", "やや", "やや", "非常に"];
            
            let html = '';
            for (let i = 1; i <= 16; i++) {
                html += `
                    <div class="factor-score">
                        <div class="factor-name">Q${i}: ${questionTexts[i-1]} ←→ ${questionTextsRight[i-1]}</div>
                        <div class="factor-value">${scoreLabels[responses[i]-1]} (${responses[i]})</div>
                    </div>
                `;
            }
            
            responsesListDiv.innerHTML = html;
            resultsDiv.style.display = 'block';
            
            // 結果までスクロール
            resultsDiv.scrollIntoView({ behavior: 'smooth' });
        }

        function resetForm() {
            if (confirm('入力内容をすべてリセットしますか？')) {
                document.getElementById('osaForm').reset();
                document.getElementById('results').style.display = 'none';
                document.getElementById('exportData').style.display = 'none';
                
                // 今日の日付を再設定
                const today = new Date().toISOString().split('T')[0];
                document.getElementById('surveyDate').value = today;
            }
        }

        function exportData() {
            const form = document.getElementById('osaForm');
            const formData = new FormData(form);
            
            // 調査日
            const surveyDate = formData.get('surveyDate') || '';
            
            // 全項目の回答チェック
            let allAnswered = true;
            const responses = {};
            
            for (let i = 1; i <= 16; i++) {
                const value = formData.get(`q${i}`);
                if (!value) {
                    allAnswered = false;
                    break;
                }
                responses[i] = parseInt(value);
            }
            
            if (!allAnswered) {
                alert('すべての項目に回答してから出力してください。');
                return;
            }
            
            // ユーザー情報を含むCSV形式でデータ出力
            let csvData = 'SurveyDate,';
            if (userProfile) {
                csvData += 'UserName,UserId,';
            }
            for (let i = 1; i <= 16; i++) {
                csvData += `Q${i},`;
            }
            csvData = csvData.slice(0, -1) + '\n'; // 最後のカンマを削除して改行
            
            csvData += `${surveyDate},`;
            if (userProfile) {
                csvData += `"${userProfile.displayName}",${userProfile.userId},`;
            }
            for (let i = 1; i <= 16; i++) {
                csvData += `${responses[i]},`;
            }
            csvData = csvData.slice(0, -1); // 最後のカンマを削除
            
            // 詳細データ表示
            let detailData = `=== OSA-MA睡眠調査票 データ出力 ===
調査日: ${surveyDate}`;
            
            if (userProfile) {
                detailData += `
ユーザー名: ${userProfile.displayName}
ユーザーID: ${userProfile.userId}`;
            }
            
            detailData += `

=== 原回答データ (CSV形式) ===
${csvData}

=== 項目別回答詳細 ===
`;
            
            const questionTexts = [
                "疲れが残っている",
                "集中力がある", 
                "ぐっすり眠れた",
                "解放感がある",
                "身体がだるい",
                "食欲がある",
                "寝つくまでにウトウトしていた状態が多かった",
                "頭がはっきりしている",
                "悪夢が多かった",
                "寝付きがよかった",
                "不快な気分である",
                "しょっちゅう夢を見た",
                "睡眠中にしょっちゅう目が覚めた",
                "いますぐ、調査にテキパキと答えられる",
                "睡眠時間が長かった",
                "眠りが浅かった"
            ];

            const questionTextsRight = [
                "疲れが取れている",
                "集中力がない",
                "ぐっすり眠れなかった", 
                "ストレスを感じる",
                "身体がシャキッとしている",
                "食欲がない",
                "寝つくまでにウトウトしていた状態が少なかった",
                "頭がボーとしている",
                "悪夢は見なかった",
                "寝付きが悪かった",
                "さわやかな気分である",
                "夢をみなかった",
                "睡眠中に目が覚めなかった",
                "答えるのは面倒である",
                "睡眠時間が短かった",
                "眠りが深かった"
            ];
            
            const scoreLabels = ["非常に", "やや", "やや", "非常に"];
            
            for (let i = 1; i <= 16; i++) {
                detailData += `Q${i}: ${questionTexts[i-1]} ←→ ${questionTextsRight[i-1]} → ${scoreLabels[responses[i]-1]} (${responses[i]})\n`;
            }
            
            document.getElementById('exportData').textContent = detailData;
            document.getElementById('exportData').style.display = 'block';
            
            // クリップボードにコピー
            navigator.clipboard.writeText(csvData).then(() => {
                alert('CSVデータがクリップボードにコピーされました。\n詳細データは下部に表示されています。');
            }).catch(() => {
                alert('データ出力が完了しました。下部の詳細データをご確認ください。');
            });
        }

        // ページ読み込み時の初期化
        document.addEventListener('DOMContentLoaded', function() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('surveyDate').value = today;
            
            // LIFF初期化を試行
            if (typeof liff !== 'undefined') {
                initializeLiff();
            }
        });

        // エンターキーでの送信を防止
        document.addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && e.target.tagName !== 'BUTTON') {
                e.preventDefault();
            }
        });
    </script>
                detailData += `Q${i}: ${questionTexts[i-1]} ←→ ${questionTextsRight[i-1]} → ${scoreLabels[responses[i]-1]} (${responses[i]})\n`;
            }
            
            document.getElementById('exportData').textContent = detailData;
            document.getElementById('exportData').style.display = 'block';
            
            // クリップボードにコピー
            navigator.clipboard.writeText(csvData).then(() => {
                alert('CSVデータがクリップボードにコピーされました。\n詳細データは下部に表示されています。');
            }).catch(() => {
                alert('データ出力が完了しました。下部の詳細データをご確認ください。');
            });
        }

        // ページ読み込み時に今日の日付を設定
        document.addEventListener('DOMContentLoaded', function() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('surveyDate').value = today;
        });

        // エンターキーでの送信を防止
        document.addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && e.target.tagName !== 'BUTTON') {
                e.preventDefault();
            }
        });
    </script>
</body>
</html>
