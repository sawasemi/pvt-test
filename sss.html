<!DOCTYPE html>

<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>„Çπ„Çø„É≥„Éï„Ç©„Éº„ÉâÁú†Ê∞óÂ∞∫Â∫¶ÔºàSSSÔºâË™øÊüª„Éï„Ç©„Éº„É†</title>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <style>
        body {
            font-family: 'Noto Sans JP', 'Hiragino Sans', 'Yu Gothic', sans-serif;
            max-width: 100%;
            margin: 0;
            padding: 10px;
            background-color: #f0f8ff;
            line-height: 1.6;
            font-size: 14px;
        }

```
    .header {
        background: linear-gradient(135deg, #4169e1 0%, #6495ed 100%);
        color: white;
        padding: 20px 15px;
        border-radius: 10px;
        text-align: center;
        margin-bottom: 20px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }
    
    .header h1 {
        margin: 0;
        font-size: 20px;
        font-weight: 300;
    }
    
    .header p {
        margin: 8px 0 0 0;
        opacity: 0.9;
        font-size: 13px;
    }
    
    .form-container {
        background: white;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        margin-bottom: 20px;
    }
    
    .survey-info {
        display: flex;
        justify-content: center;
        margin-bottom: 25px;
        padding: 15px;
        background: #f0f8ff;
        border-radius: 8px;
        border: 1px solid #4169e1;
    }
    
    .instruction {
        background: #e6f3ff;
        padding: 20px;
        border-radius: 10px;
        margin-bottom: 25px;
        border-left: 4px solid #4169e1;
    }
    
    .instruction h3 {
        margin: 0 0 10px 0;
        color: #2c3e50;
        font-size: 16px;
    }
    
    .instruction p {
        margin: 0;
        color: #333;
        font-size: 15px;
        font-weight: 500;
    }
    
    .options-container {
        margin-top: 25px;
    }
    
    .option-item {
        margin-bottom: 15px;
        padding: 15px;
        border: 2px solid #e9ecef;
        border-radius: 10px;
        cursor: pointer;
        transition: all 0.3s ease;
        background: white;
        position: relative;
    }
    
    .option-item:hover {
        border-color: #4169e1;
        background: #f8fbff;
        transform: translateY(-1px);
        box-shadow: 0 3px 10px rgba(65, 105, 225, 0.15);
    }
    
    .option-item:has(input:checked) {
        border-color: #4169e1;
        background: #f0f8ff;
        box-shadow: 0 3px 15px rgba(65, 105, 225, 0.25);
    }
    
    .option-content {
        display: flex;
        align-items: flex-start;
        gap: 15px;
    }
    
    .option-number {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 35px;
        height: 35px;
        background: #4169e1;
        color: white;
        border-radius: 50%;
        font-weight: bold;
        font-size: 16px;
        flex-shrink: 0;
    }
    
    .option-item:has(input:checked) .option-number {
        background: #ff6b6b;
        box-shadow: 0 2px 8px rgba(255, 107, 107, 0.4);
    }
    
    .option-text {
        flex: 1;
        font-size: 15px;
        line-height: 1.5;
        color: #2c3e50;
        padding-top: 5px;
    }
    
    .option-radio {
        position: absolute;
        opacity: 0;
        width: 100%;
        height: 100%;
        cursor: pointer;
        margin: 0;
    }
    
    .input-field {
        width: 100%;
        padding: 12px;
        border: 2px solid #e9ecef;
        border-radius: 6px;
        font-size: 16px;
        transition: border-color 0.3s ease;
        box-sizing: border-box;
    }
    
    .input-field:focus {
        outline: none;
        border-color: #4169e1;
    }
    
    .button-group {
        display: flex;
        flex-direction: column;
        gap: 10px;
        margin-top: 30px;
        padding: 0 5px;
    }
    
    .btn {
        width: 100%;
        padding: 15px 20px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 16px;
        font-weight: 500;
        transition: all 0.3s ease;
        min-height: 50px;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
    }
    
    .btn-primary {
        background: linear-gradient(135deg, #4169e1 0%, #6495ed 100%);
        color: white;
    }
    
    .btn-primary:hover {
        transform: translateY(-1px);
        box-shadow: 0 4px 15px rgba(65, 105, 225, 0.4);
    }
    
    .btn-secondary {
        background: #6c757d;
        color: white;
    }
    
    .btn-secondary:hover {
        background: #5a6268;
        transform: translateY(-1px);
    }
    
    .results {
        margin-top: 20px;
        padding: 20px;
        background: #f0f8ff;
        border-radius: 10px;
        border-left: 4px solid #4169e1;
    }
    
    .results h3 {
        color: #2c3e50;
        margin-bottom: 15px;
        font-size: 18px;
    }
    
    .result-item {
        display: flex;
        flex-direction: column;
        gap: 10px;
        padding: 15px;
        margin: 10px 0;
        background: white;
        border-radius: 8px;
        border: 1px solid #dee2e6;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    
    .result-header {
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .result-number {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 30px;
        height: 30px;
        background: #4169e1;
        color: white;
        border-radius: 50%;
        font-weight: bold;
        font-size: 14px;
    }
    
    .result-label {
        font-weight: bold;
        color: #4169e1;
        font-size: 16px;
    }
    
    .result-description {
        color: #2c3e50;
        font-size: 14px;
        line-height: 1.5;
        margin-left: 40px;
    }
    
    .export-data {
        margin-top: 15px;
        padding: 15px;
        background: #e9ecef;
        border-radius: 6px;
        font-family: monospace;
        font-size: 11px;
        white-space: pre-wrap;
        max-height: 200px;
        overflow-y: auto;
        line-height: 1.4;
    }
    
    .liff-status {
        background: #00C300;
        color: white;
        padding: 12px;
        border-radius: 6px;
        margin-bottom: 15px;
        text-align: center;
        font-size: 14px;
    }
    
    .liff-error {
        background: #ff4757;
        color: white;
        padding: 12px;
        border-radius: 6px;
        margin-bottom: 15px;
        text-align: center;
        font-size: 14px;
    }
    
    .user-info {
        background: #f0f8ff;
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 15px;
        border: 1px solid #dee2e6;
    }
    
    .user-info h4 {
        margin: 0 0 10px 0;
        color: #2c3e50;
        font-size: 16px;
    }
    
    .user-info p {
        margin: 5px 0;
        font-size: 14px;
        color: #6c757d;
        word-break: break-all;
    }
    
    .btn-line {
        background: #00C300;
        color: white;
    }
    
    .btn-line:hover {
        background: #00B900;
        transform: translateY(-1px);
    }
    
    .btn-line::before {
        content: "üì±";
        margin-right: 8px;
    }
    
    #shareLineBtn::before {
        content: "üì§";
        margin-right: 8px;
    }
    
    .share-modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 1000;
    }
    
    .share-content {
        background: white;
        padding: 25px;
        border-radius: 15px;
        max-width: 90%;
        width: 400px;
        text-align: center;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    }
    
    .share-content h3 {
        margin: 0 0 20px 0;
        color: #2c3e50;
        font-size: 18px;
    }
    
    .share-preview {
        background: #f0f8ff;
        padding: 15px;
        border-radius: 10px;
        margin: 15px 0;
        text-align: left;
        font-size: 14px;
        line-height: 1.5;
        border: 1px solid #dee2e6;
        white-space: pre-line;
    }
    
    .share-buttons {
        display: flex;
        gap: 10px;
        margin-top: 20px;
    }
    
    .share-buttons .btn {
        flex: 1;
        margin: 0;
    }
    
    /* „Çø„ÉÉ„ÉÅ„Éá„Éê„Ç§„ÇπÂêë„Åë„ÅÆË™øÊï¥ */
    @media (hover: none) and (pointer: coarse) {
        .option-item:hover {
            border-color: #e9ecef;
            background: white;
            transform: none;
            box-shadow: none;
        }
        
        .option-item:active {
            border-color: #4169e1;
            background: #f8fbff;
        }
        
        .btn:hover {
            transform: none;
            box-shadow: none;
        }
        
        .btn:active {
            transform: scale(0.98);
        }
    }
    
    /* Ê•µÂ∞èÁîªÈù¢„Åß„ÅÆË™øÊï¥ */
    @media (max-width: 360px) {
        body {
            padding: 5px;
            font-size: 13px;
        }
        
        .header {
            padding: 15px 10px;
        }
        
        .header h1 {
            font-size: 18px;
        }
        
        .form-container {
            padding: 15px;
        }
        
        .option-item {
            padding: 12px;
            margin-bottom: 12px;
        }
        
        .option-number {
            width: 30px;
            height: 30px;
            font-size: 14px;
        }
        
        .option-text {
            font-size: 14px;
        }
    }
    
    /* Ê®™Âêë„ÅçË°®Á§∫„Åß„ÅÆË™øÊï¥ */
    @media (orientation: landscape) and (max-height: 500px) {
        .header {
            padding: 15px;
            margin-bottom: 15px;
        }
        
        .header h1 {
            font-size: 18px;
        }
        
        .header p {
            display: none;
        }
        
        .option-item {
            margin-bottom: 10px;
            padding: 12px;
        }
    }
    
    /* „ÉÄ„Éº„ÇØ„É¢„Éº„ÉâÂØæÂøú */
    @media (prefers-color-scheme: dark) {
        body {
            background-color: #1a1a1a;
            color: #ffffff;
        }
        
        .form-container {
            background: #2d2d2d;
            color: #ffffff;
        }
        
        .option-item {
            background: #333333;
            border-color: #444444;
            color: #ffffff;
        }
        
        .option-item:has(input:checked) {
            background: #1a1a3a;
        }
        
        .survey-info, .user-info {
            background: #333333;
            border-color: #444444;
        }
        
        .instruction {
            background: #2a2a3a;
        }
        
        .input-field {
            background: #333333;
            border-color: #444444;
            color: #ffffff;
        }
        
        .results {
            background: #2d2d2d;
        }
        
        .result-item {
            background: #333333;
            border-color: #444444;
        }
    }
</style>
```

</head>
<body>
    <div class="header">
        <h1>„Çπ„Çø„É≥„Éï„Ç©„Éº„ÉâÁú†Ê∞óÂ∞∫Â∫¶ÔºàSSSÔºâ</h1>
        <p>Stanford Sleepiness Scale</p>
    </div>

```
<div class="form-container">
    <div id="liffStatus" class="liff-status" style="display: none;">
        LIFF„Ç¢„Éó„É™„Å®„Åó„Å¶Ëµ∑Âãï‰∏≠...
    </div>
    
    <div id="liffError" class="liff-error" style="display: none;">
        LIFFÂàùÊúüÂåñ„Ç®„É©„Éº
    </div>
    
    <div id="userInfo" class="user-info" style="display: none;">
        <h4>„É¶„Éº„Ç∂„ÉºÊÉÖÂ†±</h4>
        <p id="userName">ÂêçÂâç: ÂèñÂæó‰∏≠...</p>
        <p id="userId">„É¶„Éº„Ç∂„ÉºID: ÂèñÂæó‰∏≠...</p>
    </div>

    <form id="sssForm">
        <div class="survey-info">
            <div>
                <label for="surveyDate">Ë™øÊüªÊó•ÊôÇ:</label>
                <input type="datetime-local" id="surveyDate" name="surveyDate" class="input-field">
            </div>
        </div>

        <div class="instruction">
            <h3>üìã Ë™øÊüªÂÜÖÂÆπ</h3>
            <p>ÁèæÂú®„ÅÆ„ÅÇ„Å™„Åü„ÅÆÁú†Ê∞ó„Å´„Å§„ÅÑ„Å¶„ÄÅÊúÄ„ÇÇËøë„ÅÑ„ÇÇ„ÅÆ„Çí‰∏Ä„Å§ÈÅ∏„Å≥Áï™Âè∑„Çí„Çø„ÉÉ„Éó„Åó„Å¶„Åè„Å†„Åï„ÅÑ</p>
        </div>

        <div class="options-container">
            <div class="option-item">
                <input type="radio" id="sss1" name="sleepiness" value="1" class="option-radio">
                <div class="option-content">
                    <div class="option-number">1</div>
                    <div class="option-text">„ÇÑ„ÇãÊ∞ó„Åå„ÅÇ„Çä„ÄÅÊ¥ªÁô∫„Åß„ÄÅÈ†≠„Åå„Åï„Åà„Å¶„ÅÑ„Å¶„ÄÅÁú†„Åè„Å™„ÅÑÊÑü„Åò</div>
                </div>
            </div>

            <div class="option-item">
                <input type="radio" id="sss2" name="sleepiness" value="2" class="option-radio">
                <div class="option-content">
                    <div class="option-number">2</div>
                    <div class="option-text">ÊúÄÈ´ò„Å®„ÅØ„ÅÑ„Åà„Å™„ÅÑ„Åæ„Åß„ÇÇ„ÄÅÈ†≠„ÅÆÂÉç„Åç„ÅåÊ¥ªÁô∫„ÄÅÈõÜ‰∏≠„Åó„Å¶„ÅÑ„Çâ„Çå„Çã</div>
                </div>
            </div>

            <div class="option-item">
                <input type="radio" id="sss3" name="sleepiness" value="3" class="option-radio">
                <div class="option-content">
                    <div class="option-number">3</div>
                    <div class="option-text">„Åè„Å§„Çç„ÅÑ„ÅßËµ∑„Åç„Å¶„ÅÑ„Çã„ÄÅ„Åó„Åã„Åó„Å©„Å°„Çâ„Åã„Å®„ÅÑ„ÅÜ„Å®„Åô„Åì„ÅóÈ†≠„Åå„Åº„Çì„ÇÑ„Çä„ÅóÂèçÂøú„ÅåÊÇ™„ÅÑ</div>
                </div>
            </div>

            <div class="option-item">
                <input type="radio" id="sss4" name="sleepiness" value="4" class="option-radio">
                <div class="option-content">
                    <div class="option-number">4</div>
                    <div class="option-text">„Åô„Åì„Åó„Åº„Çì„ÇÑ„Çä„Åó„Å¶„ÅÑ„Å¶„ÄÅ‰Ωï„Åã„Åó„Åü„ÅÑ„Å®ÊÄù„Çè„Å™„ÅÑ</div>
                </div>
            </div>

            <div class="option-item">
                <input type="radio" id="sss5" name="sleepiness" value="5" class="option-radio">
                <div class="option-content">
                    <div class="option-number">5</div>
                    <div class="option-text">„Åº„Çì„ÇÑ„Çä„Åó„Å¶„ÅÑ„Çã„ÄÅÈõÜ‰∏≠„Åó„Å¶„ÅÑ„Çâ„Çå„Å™„ÅÑ„ÄÅËµ∑„Åç„Å¶„ÅÑ„Çã„ÅÆ„ÅåÂõ∞Èõ£</div>
                </div>
            </div>

            <div class="option-item">
                <input type="radio" id="sss6" name="sleepiness" value="6" class="option-radio">
                <div class="option-content">
                    <div class="option-number">6</div>
                    <div class="option-text">Áú†„ÅÑ„ÅÆ„ÅßÊ®™„Å´„Å™„Çä„Åü„ÅÑ„ÄÅ„Åº„Åä„Å£„Å®„Åó„Å¶„ÅÑ„Çã</div>
                </div>
            </div>

            <div class="option-item">
                <input type="radio" id="sss7" name="sleepiness" value="7" class="option-radio">
                <div class="option-content">
                    <div class="option-number">7</div>
                    <div class="option-text">„Åæ„Å©„Çç„Çì„Åß„ÅÑ„Çã„ÄÅËµ∑„Åç„Å¶„ÅÑ„Çâ„Çå„Å™„ÅÑ„ÄÅ„Åô„Åê„Å´„Å≠„ÇÄ„Å£„Å¶„Åó„Åæ„ÅÑ„Åù„ÅÜ„Å†</div>
                </div>
            </div>
        </div>

        <div class="button-group">
            <button type="button" class="btn btn-primary" onclick="showResults()">ÁµêÊûúÁ¢∫Ë™ç</button>
            <button type="button" class="btn btn-secondary" onclick="resetForm()">„É™„Çª„ÉÉ„Éà</button>
            <button type="button" class="btn btn-secondary" onclick="exportData()">„Éá„Éº„ÇøÂá∫Âäõ</button>
            <button type="button" class="btn btn-line" onclick="sendToLine()" id="sendLineBtn" style="display: none;">LINE„Å´ÈÄÅ‰ø°</button>
            <button type="button" class="btn btn-line" onclick="shareToLine()" id="shareLineBtn">LINEÂÖ±Êúâ</button>
        </div>
    </form>

    <div id="results" class="results" style="display: none;">
        <h3>üìä ÁµêÊûúÁ¢∫Ë™ç</h3>
        <div id="resultContent"></div>
        <div id="exportData" class="export-data" style="display: none;"></div>
    </div>
</div>

<!-- ÂÖ±Êúâ„É¢„Éº„ÉÄ„É´ -->
<div id="shareModal" class="share-modal">
    <div class="share-content">
        <h3>üìä Áú†Ê∞óÂ∞∫Â∫¶ÁµêÊûú„ÇíÂÖ±Êúâ</h3>
        <div id="sharePreview" class="share-preview"></div>
        <div class="share-buttons">
            <button class="btn btn-line" onclick="executeLineShare()">LINE „ÅßÂÖ±Êúâ</button>
            <button class="btn btn-secondary" onclick="copyShareText()">„ÉÜ„Ç≠„Çπ„Éà„Çí„Ç≥„Éî„Éº</button>
            <button class="btn btn-secondary" onclick="closeShareModal()">„Ç≠„É£„É≥„Çª„É´</button>
        </div>
    </div>
</div>

<script>
    // LIFFÈñ¢ÈÄ£„ÅÆÂ§âÊï∞
    let liffInitialized = false;
    let userProfile = null;
    
    // Áú†Ê∞ó„É¨„Éô„É´„ÅÆË™¨Êòé
    const sleepinessLevels = [
        { level: 1, description: "„ÇÑ„ÇãÊ∞ó„Åå„ÅÇ„Çä„ÄÅÊ¥ªÁô∫„Åß„ÄÅÈ†≠„Åå„Åï„Åà„Å¶„ÅÑ„Å¶„ÄÅÁú†„Åè„Å™„ÅÑÊÑü„Åò" },
        { level: 2, description: "ÊúÄÈ´ò„Å®„ÅØ„ÅÑ„Åà„Å™„ÅÑ„Åæ„Åß„ÇÇ„ÄÅÈ†≠„ÅÆÂÉç„Åç„ÅåÊ¥ªÁô∫„ÄÅÈõÜ‰∏≠„Åó„Å¶„ÅÑ„Çâ„Çå„Çã" },
        { level: 3, description: "„Åè„Å§„Çç„ÅÑ„ÅßËµ∑„Åç„Å¶„ÅÑ„Çã„ÄÅ„Åó„Åã„Åó„Å©„Å°„Çâ„Åã„Å®„ÅÑ„ÅÜ„Å®„Åô„Åì„ÅóÈ†≠„Åå„Åº„Çì„ÇÑ„Çä„ÅóÂèçÂøú„ÅåÊÇ™„ÅÑ" },
        { level: 4, description: "„Åô„Åì„Åó„Åº„Çì„ÇÑ„Çä„Åó„Å¶„ÅÑ„Å¶„ÄÅ‰Ωï„Åã„Åó„Åü„ÅÑ„Å®ÊÄù„Çè„Å™„ÅÑ" },
        { level: 5, description: "„Åº„Çì„ÇÑ„Çä„Åó„Å¶„ÅÑ„Çã„ÄÅÈõÜ‰∏≠„Åó„Å¶„ÅÑ„Çâ„Çå„Å™„ÅÑ„ÄÅËµ∑„Åç„Å¶„ÅÑ„Çã„ÅÆ„ÅåÂõ∞Èõ£" },
        { level: 6, description: "Áú†„ÅÑ„ÅÆ„ÅßÊ®™„Å´„Å™„Çä„Åü„ÅÑ„ÄÅ„Åº„Åä„Å£„Å®„Åó„Å¶„ÅÑ„Çã" },
        { level: 7, description: "„Åæ„Å©„Çç„Çì„Åß„ÅÑ„Çã„ÄÅËµ∑„Åç„Å¶„ÅÑ„Çâ„Çå„Å™„ÅÑ„ÄÅ„Åô„Åê„Å´„Å≠„ÇÄ„Å£„Å¶„Åó„Åæ„ÅÑ„Åù„ÅÜ„Å†" }
    ];
    
    // LIFFÂàùÊúüÂåñ
    async function initializeLiff() {
        try {
            document.getElementById('liffStatus').style.display = 'block';
            document.getElementById('liffStatus').textContent = 'LIFFÂàùÊúüÂåñ‰∏≠...';
            
            awaitliff.init({ liffId:'2007512404-5D9d4gBM' });
            
            if (liff.isLoggedIn()) {
                userProfile = await liff.getProfile();
                document.getElementById('userInfo').style.display = 'block';
                document.getElementById('userName').textContent = `ÂêçÂâç: ${userProfile.displayName}`;
                document.getElementById('userId').textContent = `„É¶„Éº„Ç∂„ÉºID: ${userProfile.userId}`;
                document.getElementById('sendLineBtn').style.display = 'inline-block';
                
                document.getElementById('liffStatus').textContent = 'LINEÈÄ£Êê∫ÂÆå‰∫Ü';
                setTimeout(() => {
                    document.getElementById('liffStatus').style.display = 'none';
                }, 2000);
            } else {
                liff.login();
            }
            
            liffInitialized = true;
        } catch (error) {
            console.error('LIFFÂàùÊúüÂåñ„Ç®„É©„Éº:', error);
            document.getElementById('liffStatus').style.display = 'none';
            document.getElementById('liffError').style.display = 'block';
            document.getElementById('liffError').textContent = 'LIFFÂàùÊúüÂåñ„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇ„Éñ„É©„Ç¶„Ç∂„Åß„ÇÇÂà©Áî®ÂèØËÉΩ„Åß„Åô„ÄÇ';
        }
    }
    
    // LINEÂÖ±ÊúâÊ©üËÉΩ
    function shareToLine() {
        const form = document.getElementById('sssForm');
        const formData = new FormData(form);
        
        const sleepinessLevel = formData.get('sleepiness');
        if (!sleepinessLevel) {
            alert('Áú†Ê∞ó„É¨„Éô„É´„ÇíÈÅ∏Êäû„Åó„Å¶„Åã„ÇâÂÖ±Êúâ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
            return;
        }
        
        const shareText = generateShareText(parseInt(sleepinessLevel), formData.get('surveyDate'));
        document.getElementById('sharePreview').textContent = shareText;
        document.getElementById('shareModal').style.display = 'flex';
    }
    
    function generateShareText(level, surveyDate) {
        const levelData = sleepinessLevels[level - 1];
        
        let shareText = `üò¥ „Çπ„Çø„É≥„Éï„Ç©„Éº„ÉâÁú†Ê∞óÂ∞∫Â∫¶ÔºàSSSÔºâÁµêÊûú\n`;
        if (surveyDate) {
            const date = new Date(surveyDate);
            shareText += `üìÖ ${date.toLocaleString('ja-JP')}\n`;
        }
        shareText += `\nüìä Áú†Ê∞ó„É¨„Éô„É´: ${level}\n`;
        shareText += `üí≠ ${levelData.description}\n`;
        shareText += `\n#„Çπ„Çø„É≥„Éï„Ç©„Éº„ÉâÁú†Ê∞óÂ∞∫Â∫¶ #SSS #Áú†Ê∞óÊ∏¨ÂÆö`;
        
        return shareText;
    }
    
    function executeLineShare() {
        const shareText = document.getElementById('sharePreview').textContent;
        const encodedText = encodeURIComponent(shareText);
        
        const lineShareUrl = `https://social-plugins.line.me/lineit/share?url=${encodeURIComponent(window.location.href)}&text=${encodedText}`;
        
        if (navigator.userAgent.match(/iPhone|iPad|iPod|Android/i)) {
            window.open(lineShareUrl, '_blank');
        } else {
            copyShareText();
            alert('„ÉÜ„Ç≠„Çπ„Éà„Çí„ÇØ„É™„ÉÉ„Éó„Éú„Éº„Éâ„Å´„Ç≥„Éî„Éº„Åó„Åæ„Åó„Åü„ÄÇ\nLINE„ÅßË≤º„Çä‰ªò„Åë„Å¶ÂÖ±Êúâ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
        }
        
        closeShareModal();
    }
    
    function copyShareText() {
        const shareText = document.getElementById('sharePreview').textContent;
        navigator.clipboard.writeText(shareText).then(() => {
            alert('ÂÖ±Êúâ„ÉÜ„Ç≠„Çπ„Éà„Çí„ÇØ„É™„ÉÉ„Éó„Éú„Éº„Éâ„Å´„Ç≥„Éî„Éº„Åó„Åæ„Åó„ÅüÔºÅ');
        }).catch(() => {
            const textArea = document.createElement('textarea');
            textArea.value = shareText;
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand('copy');
            document.body.removeChild(textArea);
            alert('ÂÖ±Êúâ„ÉÜ„Ç≠„Çπ„Éà„Çí„Ç≥„Éî„Éº„Åó„Åæ„Åó„ÅüÔºÅ');
        });
        closeShareModal();
    }
    
    function closeShareModal() {
        document.getElementById('shareModal').style.display = 'none';
    }
    
    // „É¢„Éº„ÉÄ„É´Â§ñ„ÇØ„É™„ÉÉ„ÇØ„ÅßÈñâ„Åò„Çã
    document.addEventListener('click', function(e) {
        const modal = document.getElementById('shareModal');
        if (e.target === modal) {
            closeShareModal();
        }
    });

    // LINE„Å´ÁµêÊûú„ÇíÈÄÅ‰ø°ÔºàLIFFÂÜÖ„Åß„ÅÆ‰ΩøÁî®Ôºâ
    async function sendToLine() {
        if (!liffInitialized || !liff.isLoggedIn()) {
            alert('LINEÈÄ£Êê∫„ÅåÂøÖË¶Å„Åß„Åô„ÄÇ');
            return;
        }
        
        const form = document.getElementById('sssForm');
        const formData = new FormData(form);
        
        const sleepinessLevel = formData.get('sleepiness');
        if (!sleepinessLevel) {
            alert('Áú†Ê∞ó„É¨„Éô„É´„ÇíÈÅ∏Êäû„Åó„Å¶„Åã„ÇâÈÄÅ‰ø°„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
            return;
        }
        
        const shareText = generateShareText(parseInt(sleepinessLevel), formData.get('surveyDate'));
        
        try {
            await liff.sendMessages([{
                type: 'text',
                text: shareText
            }]);
            
            alert('ÁµêÊûú„ÇíLINE„Å´ÈÄÅ‰ø°„Åó„Åæ„Åó„ÅüÔºÅ');
        } catch (error) {
            console.error('LINEÈÄÅ‰ø°„Ç®„É©„Éº:', error);
            alert('LINEÈÄÅ‰ø°„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇ');
        }
    }

    function showResults() {
        const form = document.getElementById('sssForm');
        const formData = new FormData(form);
        
        const sleepinessLevel = formData.get('sleepiness');
        if (!sleepinessLevel) {
            alert('Áú†Ê∞ó„É¨„Éô„É´„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
            return;
        }
        
        displayResults(parseInt(sleepinessLevel), formData.get('surveyDate'));
    }

    function displayResults(level, surveyDate) {
        const resultsDiv = document.getElementById('results');
        const resultContentDiv = document.getElementById('resultContent');
        
        const levelData = sleepinessLevels[level - 1];
        
        let html = `
            <div class="result-item">
                <div class="result-header">
                    <div class="result-number">${level}</div>
                    <div class="result-label">Áú†Ê∞ó„É¨„Éô„É´ ${level}</div>
                </div>
                <div class="result-description">${levelData.description}</div>
            </div>
        `;
        
        if (surveyDate) {
            const date = new Date(surveyDate);
            html = `
                <div class="result-item">
                    <div class="result-header">
                        <div class="result-number">üìÖ</div>
                        <div class="result-label">Ë™øÊüªÊó•ÊôÇ</div>
                    </div>
                    <div class="result-description">${date.toLocaleString('ja-JP')}</div>
                </div>
            ` + html;
        }
        
        resultContentDiv.innerHTML = html;
        resultsDiv.style.display = 'block';
        
        resultsDiv.scrollIntoView({ behavior: 'smooth' });
    }

    function resetForm() {
        if (confirm('ÂÖ•ÂäõÂÜÖÂÆπ„Çí„É™„Çª„ÉÉ„Éà„Åó„Åæ„Åô„ÅãÔºü')) {
            document.getElementById('sssForm').reset();
            document.getElementById('results').style.display = 'none';
            document.getElementById('exportData').style.display = 'none';
            
            // ÁèæÂú®„ÅÆÊó•ÊôÇ„ÇíÂÜçË®≠ÂÆö
            const now = new Date();
            const localDateTime = new Date(now.getTime() - now.getTimezoneOffset() * 60000).toISOString().slice(0, 16);
            document.
```
